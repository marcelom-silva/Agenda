(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[95],{33321:function(e,r,i){Promise.resolve().then(i.bind(i,71021))},71021:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return d}});var o=i(57437),n=i(2265),a=i(27648),s=i(80605),t=i(99376);let l="qmCsutASKb3FMYpSTltQUiSj";var c=()=>{let{data:e,status:r}=(0,s.useSession)(),[i,o]=(0,n.useState)("idle"),[a,t]=(0,n.useState)(null);(0,n.useEffect)(()=>{if("authenticated"===r&&(null==e?void 0:e.user)&&"serviceWorker"in navigator&&"PushManager"in window){if(!l){console.warn("Chave VAPID p\xfablica n\xe3o configurada. As notifica\xe7\xf5es push n\xe3o funcionar\xe3o."),t("Configura\xe7\xe3o de notifica\xe7\xe3o incompleta no servidor."),o("error");return}(async()=>{try{let e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registrado:",e);let r=Notification.permission;if("default"===r&&(r=await Notification.requestPermission()),"granted"===r){o("subscribing");let r=await e.pushManager.getSubscription();if(r)console.log("Usu\xe1rio j\xe1 inscrito:",r),o("subscribed");else{console.log("Inscrevendo novo usu\xe1rio...");let r=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let r="=".repeat((4-e.length%4)%4),i=(e+r).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(i),n=new Uint8Array(o.length);for(let e=0;e<o.length;++e)n[e]=o.charCodeAt(e);return n}(l)});console.log("Nova inscri\xe7\xe3o:",r),await c(r),o("subscribed")}}else console.warn("Permiss\xe3o para notifica\xe7\xf5es negada."),o("denied"),t("Permiss\xe3o para notifica\xe7\xf5es foi negada.")}catch(e){console.error("Falha ao registrar SW ou inscrever:",e),t(e instanceof Error?e.message:"Erro desconhecido ao configurar notifica\xe7\xf5es."),o("error")}})()}else"serviceWorker"in navigator&&"PushManager"in window||(console.warn("Navegador n\xe3o suporta Service Worker ou Push Notifications."),o("unsupported"))},[e,r]);let c=async e=>{try{let r=await fetch("/api/save-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw Error(e.error||"Falha ao enviar inscri\xe7\xe3o para o backend")}console.log("Inscri\xe7\xe3o enviada para o backend com sucesso.")}catch(e){console.error("Erro ao enviar inscri\xe7\xe3o para o backend:",e)}};return null};function d(e){var r,i;let{children:l}=e,{data:d,status:u}=(0,s.useSession)(),h=(0,t.useRouter)();return(n.useEffect(()=>{"loading"===u||d||h.push("/api/auth/signin")},[d,u,h]),"loading"===u)?(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,o.jsx)("p",{children:"Carregando sua sess\xe3o..."})}):d?(0,o.jsxs)("div",{style:{display:"flex",height:"100vh"},children:[(0,o.jsx)(c,{})," ",(0,o.jsxs)("aside",{style:{width:"250px",backgroundColor:"#f0f0f0",padding:"20px",display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{children:"PocketPlanner"}),(0,o.jsx)("nav",{children:(0,o.jsxs)("ul",{style:{listStyleType:"none",padding:0},children:[(0,o.jsx)("li",{style:{marginBottom:"10px"},children:(0,o.jsx)(a.default,{href:"/dashboard",children:"Dashboard (Tarefas)"})}),(0,o.jsx)("li",{style:{marginBottom:"10px"},children:(0,o.jsx)(a.default,{href:"/financeiro",children:"Financeiro"})})]})})]}),(0,o.jsxs)("div",{style:{marginTop:"auto",paddingTop:"20px",borderTop:"1px solid #ccc"},children:[(0,o.jsxs)("p",{children:["Usu\xe1rio: ",(null===(r=d.user)||void 0===r?void 0:r.name)||(null===(i=d.user)||void 0===i?void 0:i.email)]}),(0,o.jsx)("button",{onClick:()=>(0,s.signOut)({callbackUrl:"/"}),style:{width:"100%",padding:"10px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Sair"})]})]}),(0,o.jsx)("main",{style:{flexGrow:1,padding:"20px",overflowY:"auto"},children:l})]}):null}}},function(e){e.O(0,[448,605,971,117,744],function(){return e(e.s=33321)}),_N_E=e.O()}]);