(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[169],{3236:function(e,t,a){Promise.resolve().then(a.bind(a,21218))},21218:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var n=a(57437),r=a(2265),i=a(47625),s=a(75169),o=a(3574),l=a(20407),d=a(8147),c=a(22190);let x=[{name:"Alimenta\xe7\xe3o",value:400},{name:"Transporte",value:300},{name:"Moradia",value:800},{name:"Lazer",value:200},{name:"Outros",value:150}],p=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"];var u=e=>{let{data:t=x}=e;return(0,n.jsx)("div",{style:{width:"100%",height:300},children:(0,n.jsx)(i.h,{children:(0,n.jsxs)(s.u,{children:[(0,n.jsx)(o.b,{data:t,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",children:t.map((e,t)=>(0,n.jsx)(l.b,{fill:p[t%p.length]},"cell-".concat(t)))}),(0,n.jsx)(d.u,{formatter:e=>"R$ ".concat(e.toFixed(2))}),(0,n.jsx)(c.D,{})]})})})},h=a(21156),g=a(56940),m=a(97059),y=a(62994),j=a(54061);let f=[{name:"Jan",Gastos:4e3,Receitas:5e3},{name:"Fev",Gastos:3e3,Receitas:4500},{name:"Mar",Gastos:2e3,Receitas:6e3},{name:"Abr",Gastos:2780,Receitas:3908},{name:"Mai",Gastos:1890,Receitas:4800},{name:"Jun",Gastos:2390,Receitas:3800},{name:"Jul",Gastos:3490,Receitas:4300}];var b=e=>{let{data:t=f}=e;return(0,n.jsx)("div",{style:{width:"100%",height:300},children:(0,n.jsx)(i.h,{children:(0,n.jsxs)(h.w,{data:t,margin:{top:5,right:30,left:20,bottom:5},children:[(0,n.jsx)(g.q,{strokeDasharray:"3 3"}),(0,n.jsx)(m.K,{dataKey:"name"}),(0,n.jsx)(y.B,{}),(0,n.jsx)(d.u,{formatter:e=>"R$ ".concat(e.toFixed(2))}),(0,n.jsx)(c.D,{}),(0,n.jsx)(j.x,{type:"monotone",dataKey:"Receitas",stroke:"#82ca9d",activeDot:{r:8}}),(0,n.jsx)(j.x,{type:"monotone",dataKey:"Gastos",stroke:"#ff7300"})]})})})},v=e=>{let{isOpen:t,onClose:a,onSave:i,entry:s}=e,[o,l]=(0,r.useState)(""),[d,c]=(0,r.useState)(""),[x,p]=(0,r.useState)("expense"),[u,h]=(0,r.useState)(""),[g,m]=(0,r.useState)(""),[y,j]=(0,r.useState)(!1),[f,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{s?(l(s.description||""),c(void 0!==s.amount?s.amount.toString():""),p(s.type||"expense"),h(s.category||""),m(s.dueDate?new Date(s.dueDate).toISOString().split("T")[0]:"")):(l(""),c(""),p("expense"),h(""),m(new Date().toISOString().split("T")[0])),b(null)},[s,t]);let v=async e=>{if(e.preventDefault(),b(null),j(!0),!o.trim()||!d||!g){b("Descri\xe7\xe3o, valor e data de vencimento s\xe3o obrigat\xf3rios."),j(!1);return}let t=parseFloat(String(d));if(isNaN(t)){b("O valor deve ser um n\xfamero."),j(!1);return}let n={...s||{},description:o,amount:t,type:x,category:u.trim()||("expense"===x?"Despesa Diversa":"Receita Diversa"),dueDate:g};try{let e;if(s&&s.id)e=await fetch("/api/financial-entries/".concat(s.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});else{let{id:t,...a}=n;e=await fetch("/api/financial-entries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}if(!e.ok){let t=await e.json();throw Error(t.error||"HTTP error! status: ".concat(e.status))}i(),a()}catch(e){console.error("Falha ao salvar entrada financeira:",e),b(e instanceof Error?e.message:"Ocorreu um erro desconhecido.")}finally{j(!1)}};return t?(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,n.jsxs)("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"5px",width:"450px",maxHeight:"90vh",overflowY:"auto"},children:[(0,n.jsx)("h2",{children:s?"Editar Entrada Financeira":"Nova Entrada Financeira"}),f&&(0,n.jsx)("p",{style:{color:"red"},children:f}),(0,n.jsxs)("form",{onSubmit:v,children:[(0,n.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,n.jsx)("label",{htmlFor:"description",children:"Descri\xe7\xe3o:"}),(0,n.jsx)("input",{type:"text",id:"description",value:o,onChange:e=>l(e.target.value),style:{width:"100%",padding:"8px",boxSizing:"border-box"},required:!0})]}),(0,n.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,n.jsx)("label",{htmlFor:"amount",children:"Valor (R$):"}),(0,n.jsx)("input",{type:"number",id:"amount",value:d,onChange:e=>c(e.target.value),style:{width:"100%",padding:"8px",boxSizing:"border-box"},required:!0,step:"0.01"})]}),(0,n.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,n.jsx)("label",{htmlFor:"type",children:"Tipo:"}),(0,n.jsxs)("select",{id:"type",value:x,onChange:e=>p(e.target.value),style:{width:"100%",padding:"8px",boxSizing:"border-box"},children:[(0,n.jsx)("option",{value:"expense",children:"Despesa"}),(0,n.jsx)("option",{value:"income",children:"Receita"})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,n.jsx)("label",{htmlFor:"category",children:"Categoria:"}),(0,n.jsx)("input",{type:"text",id:"category",value:u,onChange:e=>h(e.target.value),style:{width:"100%",padding:"8px",boxSizing:"border-box"},placeholder:"Ex: Alimenta\xe7\xe3o, Sal\xe1rio, Contas"})]}),(0,n.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,n.jsx)("label",{htmlFor:"dueDate",children:"Data de Vencimento/Ocorr\xeancia:"}),(0,n.jsx)("input",{type:"date",id:"dueDate",value:g,onChange:e=>m(e.target.value),style:{width:"100%",padding:"8px",boxSizing:"border-box"},required:!0})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[(0,n.jsx)("button",{type:"button",onClick:a,style:{padding:"10px 15px"},disabled:y,children:"Cancelar"}),(0,n.jsx)("button",{type:"submit",style:{padding:"10px 15px",backgroundColor:"#007bff",color:"white",border:"none"},disabled:y,children:y?"Salvando...":"Salvar"})]})]})]})}):null};let w={borderBottom:"2px solid #dee2e6",padding:"12px",textAlign:"left",backgroundColor:"#f8f9fa"},S={borderBottom:"1px solid #e9ecef",padding:"10px 12px",verticalAlign:"top"},D={...S,whiteSpace:"nowrap"},C=e=>({backgroundColor:"income"===e?"#e6ffed":"#ffebee"});var F=e=>{let{entries:t,onEdit:a,onDelete:r}=e;return 0===t.length?(0,n.jsx)("p",{children:"Nenhuma entrada financeira registrada para o per\xedodo selecionado."}):(0,n.jsx)("div",{style:{overflowX:"auto"},children:(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:w,children:"Descri\xe7\xe3o"}),(0,n.jsx)("th",{style:w,children:"Valor (R$)"}),(0,n.jsx)("th",{style:w,children:"Tipo"}),(0,n.jsx)("th",{style:w,children:"Categoria"}),(0,n.jsx)("th",{style:w,children:"Vencimento"}),(0,n.jsx)("th",{style:w,children:"Status"}),(0,n.jsx)("th",{style:w,children:"A\xe7\xf5es"})]})}),(0,n.jsx)("tbody",{children:t.map(e=>(0,n.jsxs)("tr",{style:C(e.type),children:[(0,n.jsx)("td",{style:S,children:e.description}),(0,n.jsx)("td",{style:S,children:e.amount.toFixed(2)}),(0,n.jsx)("td",{style:S,children:"income"===e.type?"Receita":"Despesa"}),(0,n.jsx)("td",{style:S,children:e.category}),(0,n.jsx)("td",{style:S,children:new Date(e.dueDate).toLocaleDateString()}),(0,n.jsx)("td",{style:S,children:e.paid?"Pago em ".concat(e.paidDate?new Date(e.paidDate).toLocaleDateString():""):"Pendente"}),(0,n.jsxs)("td",{style:D,children:[(0,n.jsx)("button",{onClick:()=>a(e),style:{marginRight:"5px",padding:"5px 8px",fontSize:"12px"},children:"Editar"}),(0,n.jsx)("button",{onClick:()=>r(e.id),style:{padding:"5px 8px",fontSize:"12px",backgroundColor:"#dc3545",color:"white",border:"none"},children:"Excluir"})]})]},e.id))})]})})},k=()=>{let[e,t]=(0,r.useState)([]),[a,i]=(0,r.useState)(!0),[s,o]=(0,r.useState)(!1),[l,d]=(0,r.useState)(null),[c,x]=(0,r.useState)(new Date().getMonth()),[p,h]=(0,r.useState)(new Date().getFullYear()),g=(0,r.useCallback)(async(e,a)=>{i(!0);try{let n=await fetch("/api/financial-entries");if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));let r=await n.json();r=r.filter(t=>{let n=new Date(t.dueDate);return n.getMonth()===e&&n.getFullYear()===a}),t(r.sort((e,t)=>new Date(t.dueDate).getTime()-new Date(e.dueDate).getTime()))}catch(e){console.error("Falha ao buscar entradas financeiras:",e)}finally{i(!1)}},[]);(0,r.useEffect)(()=>{g(c,p)},[g,c,p]);let m=e=>{d(e||null),o(!0)},y=()=>{o(!1),d(null)},j=async e=>{if(confirm("Tem certeza que deseja excluir esta entrada?"))try{let t=await fetch("/api/financial-entries/".concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"HTTP error! status: ".concat(t.status))}g(c,p)}catch(e){console.error("Falha ao excluir entrada:",e),alert("Erro ao excluir: ".concat(e instanceof Error?e.message:String(e)))}},f=e.filter(e=>"expense"===e.type).reduce((e,t)=>{let a=e.find(e=>e.name===t.category);return a?a.value+=t.amount:e.push({name:t.category,value:t.amount}),e},[]),w=[{name:new Date(p,c).toLocaleString("default",{month:"short"}),Gastos:e.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0),Receitas:e.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0)}],S=e=>{let t=c+e,a=p;t<0?(t=11,a--):t>11&&(t=0,a++),x(t),h(a)};return(0,n.jsxs)("div",{style:{padding:"20px"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,n.jsx)("h1",{children:"Gerenciamento Financeiro"}),(0,n.jsx)("button",{onClick:()=>m(),style:{padding:"10px 15px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"5px",cursor:"pointer"},children:"Nova Entrada"})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"20px",gap:"10px"},children:[(0,n.jsx)("button",{onClick:()=>S(-1),style:{padding:"8px 12px"},children:"< M\xeas Anterior"}),(0,n.jsx)("h2",{children:new Date(p,c).toLocaleString("default",{month:"long",year:"numeric"})}),(0,n.jsx)("button",{onClick:()=>S(1),style:{padding:"8px 12px"},children:"Pr\xf3ximo M\xeas >"})]}),a?(0,n.jsx)("p",{style:{textAlign:"center"},children:"Carregando dados financeiros..."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{display:"flex",gap:"20px",marginBottom:"30px",flexWrap:"wrap"},children:[(0,n.jsxs)("div",{style:{flex:1,minWidth:"300px",border:"1px solid #eee",padding:"15px",borderRadius:"5px"},children:[(0,n.jsx)("h2",{children:"Gastos por Categoria"}),(0,n.jsx)(u,{data:f.length>0?f:[{name:"Sem despesas",value:1}]})]}),(0,n.jsxs)("div",{style:{flex:1,minWidth:"300px",border:"1px solid #eee",padding:"15px",borderRadius:"5px"},children:[(0,n.jsx)("h2",{children:"Resumo do M\xeas"})," ",(0,n.jsx)(b,{data:w})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Entradas do M\xeas"}),(0,n.jsx)(F,{entries:e,onEdit:m,onDelete:j})]})]}),s&&(0,n.jsx)(v,{isOpen:s,onClose:y,onSave:()=>{g(c,p),y()},entry:l})]})}}},function(e){e.O(0,[3,971,117,744],function(){return e(e.s=3236)}),_N_E=e.O()}]);